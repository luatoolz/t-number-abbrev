describe("number.abbrev.millions", function()
  local t, brev, bn, tonum
  setup(function()
    t = require "t"
    brev = t.number.abbrev
    bn = brev({scale=1000, prefix='$', precision=0, decimals=1}, {'m', 'Million', ''}, {'b', 'Billion'}, {'t', 'Trillion'})
    tonum = t.to.number
  end)
  it("common", function()
    assert.is_table(t)
    local k = bn(1)
    assert.equal(1, k[1])
    assert.equal(1, tonum(k))
    assert.equal('$1m', tostring(k))
    assert.is_table(bn)
  end)
  it("init", function()
    assert.equal(0, tonum(bn(0)))
    assert.equal(1, tonum(bn(1)))
    assert.equal(-1, tonum(bn(-1)))

    assert.equal(1, tonum(bn(1 - 0.0001)))
    assert.equal(-1, tonum(bn(-1 - 0.0001)))
    assert.equal(1, tonum(bn(1 + 0.0001)))
    assert.equal(-1, tonum(bn(-1 + 0.0001)))

    assert.equal(1200, tonum(bn(1200)))
    assert.equal(-1200, tonum(bn(-1200)))
    assert.equal(1200000, tonum(bn(1200000)))
    assert.equal(-1200000, tonum(bn(-1200000)))

    assert.equal(0, tonum(bn('0')))
    assert.equal(1, tonum(bn('1')))
    assert.equal(-1, tonum(bn('-1')))
    assert.equal(1200, tonum(bn('1200')))
    assert.equal(-1200, tonum(bn('-1200')))
    assert.equal(1200000, tonum(bn('1200000')))
    assert.equal(-1200000, tonum(bn('-1200000')))
    assert.equal(1200000, tonum(bn('1200b')))
    assert.equal(-1200000, tonum(bn('-1200b')))
    assert.equal(1200000, tonum(bn('1.2t')))
    assert.equal(-1200000, tonum(bn('-1.2t')))
  end)
  it("rounds", function()
    assert.equal(671300, tonum(bn('$671.3 Billion')))
    assert.equal(671, tonum(bn(671)))
    assert.equal(671, tonum(bn({671})))
    assert.equal(671, tonum(bn('$671 Million')))
    assert.equal(671, tonum(bn('$671.3 Million')))
    assert.equal(5, tonum(bn('<$5 Million')))
    assert.equal(31800, tonum(bn('$31.8 Billion')))
    assert.equal(364100, tonum(bn('$364.1B')))
    assert.equal(26700, tonum(bn('$26.7B')))
    assert.equal(477, tonum(bn('$477M')))
    assert.equal(5, tonum(bn('<$5M')))
    assert.equal(2800, tonum(bn('$2.8B')))
    assert.equal(95, tonum(bn('$94.5M')))
    assert.equal(182, tonum(bn('$181.9M')))
    assert.equal(16600, tonum(bn('$16.6B')))
    assert.equal(219, tonum(bn('$219.3M')))
    assert.equal(67, tonum(bn('$66.8M')))
    assert.equal(36, tonum(bn('$36.4M')))
    assert.equal(1900, tonum(bn('$1.9B')))
    assert.equal(18, tonum(bn('$17.5M')))
    assert.equal(6, tonum(bn('$6.2M')))
    assert.equal(30, tonum(bn('$29.5M')))
    assert.equal(24600, tonum(bn('$24.6B')))
    assert.equal(204100, tonum(bn('$204.1B')))
    assert.equal(462, tonum(bn('$461.7Million')))
    assert.equal(462, tonum(bn('$461.7m')))
    assert.equal(462, tonum(bn('$461.7 M')))
    assert.equal(462, tonum(bn('$461.7 Million')))
    assert.equal(359, tonum(bn('$358.8 Million')))
  end)
  it("string", function()
    assert.equal('0', tostring(bn('$0')))
    assert.equal('0', tostring(bn('$0 Billion')))
    assert.equal('$671.3b', tostring(bn('$671.3 Billion')))
    assert.equal('$671m', tostring(bn(671)))
    assert.equal('$671m', tostring(bn('$671 Million')))
    assert.equal('$671m', tostring(bn('$671.3 Million')))
    assert.equal('$5m', tostring(bn('<$5 Million')))
    assert.equal('$31.8b', tostring(bn('$31.8 Billion')))
    assert.equal('$364.1b', tostring(bn('$364.1B')))
    assert.equal('$26.7b', tostring(bn('$26.7B')))
    assert.equal('$477m', tostring(bn('$477M')))
    assert.equal('$5m', tostring(bn('<$5M')))
    assert.equal('$2.8b', tostring(bn('$2.8B')))
    assert.equal('$95m', tostring(bn('$94.5M')))
    assert.equal('$182m', tostring(bn('$181.9M')))
    assert.equal('$16.6b', tostring(bn('$16.6B')))
    assert.equal('$219m', tostring(bn('$219.3M')))
    assert.equal('$67m', tostring(bn('$66.8M')))
    assert.equal('$36m', tostring(bn('$36.4M')))
    assert.equal('$1.9b', tostring(bn('$1.9B')))
    assert.equal('$18m', tostring(bn('$17.5M')))
    assert.equal('$6m', tostring(bn('$6.2M')))
    assert.equal('$30m', tostring(bn('$29.5M')))
    assert.equal('$24.6b', tostring(bn('$24.6B')))
    assert.equal('$204.1b', tostring(bn('$204.1B')))
    assert.equal('$462m', tostring(bn('$461.7Million')))
    assert.equal('$462m', tostring(bn('$461.7m')))
    assert.equal('$462m', tostring(bn('$461.7 M')))
    assert.equal('$462m', tostring(bn('$461.7 Million')))
    assert.equal('$359m', tostring(bn('$358.8 Million')))
  end)
end)